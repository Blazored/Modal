<div class="blazored-modal-focus-trap" @ref="_container" @onkeydown="HandleKeyPresses" @onkeyup="HandleKeyPresses">
    <div tabindex="@(IsActive ? 1 : 0)" @ref="_start" @onfocus="FocusEndAsync"></div>
    @ChildContent
    <div tabindex="@(IsActive ? 1 : 0)" @ref="_end" @onfocus="FocusStartAsync"></div>
</div>

@code {
    private ElementReference _container;
    private ElementReference _start;
    private ElementReference _end;
    private bool _shiftPressed;

    [Parameter] public RenderFragment ChildContent { get; set; } = default!;
    [Parameter] public bool IsActive { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await _start.FocusAsync();
        }
    }

    private async Task FocusStartAsync(FocusEventArgs args)
    {
        if (!_shiftPressed)
        {
            Console.WriteLine($"Setting focus to start");
            await _start.FocusAsync();
        }
    }

    private async Task FocusEndAsync(FocusEventArgs args)
    {
        if (_shiftPressed)
        {
            Console.WriteLine($"Setting focus to end");
            await _end.FocusAsync();
        }
    }

    private void HandleKeyPresses(KeyboardEventArgs args)
    {
        if (args.Key == "Tab")
        {
            Console.WriteLine($"Setting shift pressed: {args.ShiftKey}");
            _shiftPressed = args.ShiftKey;
        }
    }

}